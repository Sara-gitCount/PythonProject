<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasky | Dashboard</title>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-pink: #ff00ff;
            --neon-yellow: #fefe33;
            --bg-dark: #020617;
            --card-bg: rgba(15, 23, 42, 0.8);
        }

        @keyframes masterGlow {
            0% { stroke: var(--neon-blue); fill: rgba(0, 242, 255, 0.15); filter: drop-shadow(0 0 10px var(--neon-blue)); }
            50% { stroke: var(--neon-pink); fill: rgba(255, 0, 255, 0.15); filter: drop-shadow(0 0 20px var(--neon-pink)); }
            100% { stroke: var(--neon-yellow); fill: rgba(254, 254, 51, 0.15); filter: drop-shadow(0 0 15px var(--neon-yellow)); }
        }
        @keyframes lineFlow { 0% { stroke-dashoffset: 1000; } 100% { stroke-dashoffset: 0; } }
        @keyframes pulseHome {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 15px rgba(255, 255, 255, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }

        body {
            background: radial-gradient(circle at center, #0f172a 0%, var(--bg-dark) 100%);
            color: white;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            margin: 0;
            padding-bottom: 50px;
            min-height: 100vh;
        }

        .top-nav { display: flex; justify-content: space-between; align-items: center; padding: 30px 8%; }
        .brand-zone { width: 450px; height: 130px; }
        .logo-svg { width: 100%; height: 100%; overflow: visible; }
        .text-animated {
            font-size: 110px; font-weight: 900;
            stroke: var(--neon-blue); stroke-width: 3px; stroke-dasharray: 200;
            animation: lineFlow 5s linear infinite, masterGlow 5s infinite alternate ease-in-out;
        }

        .header-left { display: flex; align-items: center; gap: 60px; }
        .btn-home {
            background: white; color: black; text-decoration: none; padding: 15px 30px;
            border-radius: 18px; font-weight: 900; font-size: 20px;
            animation: pulseHome 2.5s infinite; transition: 0.3s;
        }

        .main-container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        .controls-bar {
            background: var(--card-bg); padding: 25px; border-radius: 25px;
            display: flex; gap: 20px; align-items: center; margin-bottom: 40px;
            border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px);
        }

        .filter-btn { color: white; text-decoration: none; padding: 12px 24px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); transition: 0.3s; font-weight: bold;}
        .select-status { background: #1e293b; color: white; border: 1px solid var(--neon-blue); padding: 12px; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .btn-add { background: var(--neon-pink); color: white; padding: 14px 28px; border-radius: 15px; text-decoration: none; font-weight: bold; margin-right: auto; box-shadow: 0 0 15px var(--neon-pink); }

        .task-card {
            background: var(--card-bg); border: 1px solid rgba(0, 242, 255, 0.1);
            border-radius: 20px; padding: 25px 35px; display: flex;
            justify-content: space-between; align-items: center; margin-bottom: 15px;
            transition: 0.4s;
        }
        .task-card:hover { border-color: var(--neon-blue); transform: translateX(-10px); }

        #taskModal {
            display: none; position: fixed; z-index: 9999; left: 0; top: 0;
            width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(12px); align-items: center; justify-content: center;
        }
        .modal-content {
            background: #0f172a; border: 2px solid var(--neon-blue);
            padding: 40px; border-radius: 30px; width: 85%; max-width: 500px;
            position: relative; text-align: right;
        }
        .close-x { position: absolute; top: 20px; left: 25px; font-size: 35px; color: white; cursor: pointer; transition: 0.3s; }
        .close-x:hover { color: var(--neon-pink); transform: rotate(90deg); }

        .status-badge { padding: 8px 15px; border-radius: 10px; font-weight: bold; font-size: 13px; text-align: center; min-width: 90px; }
        .status-1 { background: rgba(59, 130, 246, 0.2); border: 1px solid #3b82f6; color: #3b82f6; }
        .status-2 { background: rgba(245, 158, 11, 0.2); border: 1px solid #f59e0b; color: #f59e0b; }
        .status-3 { background: rgba(16, 185, 129, 0.2); border: 1px solid #10b981; color: #10b981; }

        .action-link { color: var(--neon-blue); text-decoration: none; font-weight: bold; border-bottom: 1px solid transparent; transition: 0.2s; }
        .action-link:hover { border-bottom: 1px solid var(--neon-blue); }

        .locked-icon { opacity: 0.3; cursor: not-allowed; filter: grayscale(1); }
    </style>
</head>
<body>

    <div id="taskModal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-x" onclick="closeModal()">&times;</span>
            <h2 id="m-title" style="color: var(--neon-blue); margin-top:0; font-size: 32px; padding-left: 40px;"></h2>
            <div style="height: 2px; background: linear-gradient(90deg, var(--neon-blue), transparent); margin-bottom: 20px;"></div>
            <p id="m-desc" style="line-height: 1.8; font-size: 18px; color: #cbd5e1;"></p>
            <p id="m-date" style="color: var(--neon-pink); font-weight: bold; margin-top: 25px; font-size: 16px;"></p>
        </div>
    </div>

    <header class="top-nav">
        <div class="brand-zone">
            <svg class="logo-svg" viewBox="0 0 500 150">
                <text x="10" y="90" class="text-animated">WORKIFY</text>
            </svg>
        </div>
        <div class="header-left">
            <span style="font-size: 20px;">×©×œ×•×, <strong>{{ staff.user.username }}</strong></span>
            <a href="{% url 'home' %}" class="btn-home">ğŸ  ×—×–×¨×” ×œ×‘×™×ª</a>
        </div>
    </header>

    <main class="main-container">
        <div class="controls-bar">
            <a href="{% url 'allTasks' %}" class="filter-btn">×›×œ ×”××©×™××•×ª</a>
            <a href="?my=1" class="filter-btn">×”××©×™××•×ª ×©×œ×™</a>

            <form method="get">
                <select name="status" onchange="this.form.submit()" class="select-status">
                    <option value="">×¡× ×Ÿ ×œ×¤×™ ×¡×˜×˜×•×¡</option>
                    <option value="1" {% if request.GET.status == "1" %}selected{% endif %}>ğŸ†• ×—×“×©</option>
                    <option value="2" {% if request.GET.status == "2" %}selected{% endif %}>â³ ×‘×ª×”×œ×™×š</option>
                    <option value="3" {% if request.GET.status == "3" %}selected{% endif %}>âœ… ×”×•×©×œ×</option>
                </select>
            </form>

            {% if staff.role == 1 %}
                <a href="{% url 'task_add' %}" class="btn-add">â• ×”×•×¡×¤×ª ××©×™××”</a>
            {% endif %}
        </div>

        <div class="tasks-grid">
            {% for task in tasks %}
            <div class="task-card">
                <div style="flex: 1;">
                    <h3 style="margin:0; font-size: 26px; color: var(--neon-blue); display: flex; align-items: center;">
                        {{ task.title }}
                        <button style="background: none; border: 1px solid var(--neon-blue); color: var(--neon-blue); cursor: pointer; border-radius: 8px; padding: 4px 8px; margin-right: 15px; font-size: 18px;"
                                onclick="showTask('{{ task.title|escapejs }}', '{{ task.description|escapejs }}', '{{ task.dateEnd|date:'d/m/Y' }}')">ğŸ“‹</button>
                    </h3>
                    <div style="margin-top: 8px; opacity: 0.6; font-weight: bold;">ğŸ“… ×™×¢×“: {{ task.dateEnd|date:"d/m/Y" }}</div>
                </div>

                <div class="status-badge status-{{ task.status }}">
                    {% if task.status == 1 %}×—×“×©{% elif task.status == 2 %}×‘×ª×”×œ×™×š{% else %}×”×•×©×œ×{% endif %}
                </div>

                <div style="display: flex; align-items: center; gap: 25px; margin-right: 50px; min-width: 220px; justify-content: flex-end;">
                    <div class="task-logic">
                        {% if task.status == 1 %}
                            <a href="{% url 'take_task' task.id %}" class="action-link">×œ×§×—×ª ×œ×˜×™×¤×•×œ â†</a>
                        {% elif task.status == 2 %}
                            {% if task.user == staff %}
                                <a href="{% url 'complete_task' task.id %}" class="action-link" style="color: var(--neon-yellow);">×¡×™×•× ××©×™××” âœ”</a>
                            {% else %}
                                <span style="font-size: 13px; opacity: 0.5;">ğŸ‘¤ {{ task.user.user.username }}</span>
                            {% endif %}
                        {% else %}
                            <span style="color: #10b981; font-weight: bold;">×‘×•×¦×¢ ×‘×”×¦×œ×—×”</span>
                        {% endif %}
                    </div>

                    {% if staff.role == 1 %}
                    <div style="display: flex; gap: 15px; padding-right: 20px; border-right: 1px solid rgba(255,255,255,0.2);">
                        {% if task.status == 1 %}
                            <a href="{% url 'task_edit' task.id %}" title="×¢×¨×™×›×”" style="text-decoration:none; font-size: 20px;">âœï¸</a>
                            <a href="{% url 'task_delete' task.id %}" title="××—×™×§×”" style="text-decoration:none; font-size: 20px;">ğŸ—‘ï¸</a>
                        {% else %}
                            <span class="locked-icon" title="×”××©×™××” × × ×¢×œ×” ×œ×¢×¨×™×›×” ×›×™ ×”×™× ×‘×˜×™×¤×•×œ" style="font-size: 20px;">ğŸ”’</span>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <div style="font-size: 50px; margin-bottom: 20px;">â˜•</div>
                <h2>××™×Ÿ ××©×™××•×ª ×œ×”×¦×’×”</h2>
            </div>
            {% endfor %}
        </div>
    </main>

    <script>
        function showTask(title, desc, date) {
            document.getElementById('m-title').innerText = title;
            document.getElementById('m-desc').innerText = desc || "××™×Ÿ ×ª×™××•×¨ ××¤×•×¨×˜ ×œ××©×™××” ×–×•.";
            document.getElementById('m-date').innerText = "×ª××¨×™×š ×™×¢×“ ×¡×•×¤×™: " + date;
            document.getElementById('taskModal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('taskModal').style.display = 'none'; }
    </script>
</body>
</html>